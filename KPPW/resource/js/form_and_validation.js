var global_formjs_valid_flag=false;var error_msg_span=null;function checkForm(f,d){error_msg_span=document.getElementById("global_error_msg_area");if(error_msg_span!=undefined&&error_msg_span!=null){error_msg_span.innerHTML=""}var b=f.elements;var a=false;for(var e=0;e<b.length;e++){var c=b[e].getAttribute("limit");if(c!=null&&c!=""){if(d){validElement(b[e]);if(!global_formjs_valid_flag){a=true}}else{if(!validElement(b[e])){b[e].focus();return false}}}}return !a}function validElement(ele){error_msg_span=document.getElementById("global_error_msg_area");var limit=ele.getAttribute("limit");if(limit==null||trim(limit)==""){return}limit=trim(limit);var msgSpan=ele.getAttribute("msgArea");if(msgSpan!=null){msgSpan=trim(msgSpan)}var errMsg=ele.getAttribute("msg");if(errMsg!=null){errMsg=trim(errMsg)}global_formjs_valid_flag=false;var form=ele.form;var formName=form.name;if(msgSpan!=null||msgSpan!=""){msgSpan=document.getElementById(msgSpan);if(msgSpan==null){msgSpan=error_msg_span}}else{msgSpan=error_msg_span}var setErrMessage=function(ele,error_msg){errMsg=(errMsg==null||errMsg=="")?ele.name+" input error:"+error_msg:errMsg;if(msgSpan!=undefined&&msgSpan!=null){msgSpan.innerHTML="";msgSpan.innerHTML=errMsg}else{alert(errMsg)}return false};var vtype="string";var required=false;var general=false;var lims=limit.split(";");for(var ii=0;ii<lims.length;ii++){if(lims[ii].indexOf(":")>0){var alim=lims[ii].split(":");if(alim[0]=="type"){vtype=alim[1]}else{if(alim[0]=="required"){required=alim[1]=="true"}else{if(alim[0]=="general"&&alim[1]=="false"){general=false}}}}else{alert("Element config error!");return false}}var valu=ele.value;var isNull=(valu==undefined)||(valu=="");if(required&&isNull){return setErrMessage(ele," can't be null.")}else{if(!isNull){switch(vtype){case"int":if(!isDigit(valu)){return setErrMessage(ele," must be int.")}break;case"digit":if(!isDigitString(valu)){return setErrMessage(ele," must be digit.")}break;case"float":if(!isFloat(valu)){return setErrMessage(ele," must be float.")}break;case"date":if(!isDateYMD(valu)){return setErrMessage(ele," must be date.")}break;case"datetime":if(!isDateTimeYMD(valu)){return setErrMessage(ele," must be datetime.")}break;case"time":if(!isTime(valu)){return setErrMessage(ele," must be time.")}break;case"tel":case"fax":if(!isTel(valu)){return setErrMessage(ele," must be tel or fax number.")}break;case"mobileCn":if(!isMobileCN(valu)){return setErrMessage(ele," must be Chinese")}break;case"ip":if(!isIP(valu)){return setErrMessage(ele," must be IP.")}break;case"url":if(!isURL(valu)){return setErrMessage(ele," must be URL.")}break;case"idCard":if(!(isIDNumber15(valu)||isIDNumber18(valu))){return setErrMessage(ele," must be Chinese IDCard number.")}break;case"email":if(!isEmail(valu)){return setErrMessage(ele," must be Email address.")}break;case"signName":if(!isSignName(valu)){return setErrMessage(ele," must be sign name:character,number,underline,point.The first char must be character.")}break;case"name":if(!isRealName(valu)){return setErrMessage(ele," must be real name:Double byte character or single byte character. or space,point.")}break;case"postcodeCn":if(!isPostalCodeCN(valu)){return setErrMessage(ele," must be valid postcode.")}break;case"string":break;default:alert("元素"+ele.name+"值类型配置有误:"+vtype);return false}if(lims!=null){for(var i=0;i<lims.length;i++){var lim=lims[i].split(":");if(lim.length!=2){alert("attrribute limit config error.");return false}if(lim[0]=="len"){var lenDesc=lim[1];if(lenDesc.indexOf("-")>-1){var als=lenDesc.split("-");if(als.length==2){if(als[0]==""){if(valu.length>parseInt(als[1])){return setErrMessage(ele," can't more than "+als[1])}}else{if(als[1]==""){if(valu.length<parseInt(als[0])){return setErrMessage(ele," can't less than "+als[0])}}else{if(valu.length<parseInt(als[0])||valu.length>parseInt(als[1])){return setErrMessage(ele," must between "+als[0]+" and "+als[1])}}}}else{alert("Element"+ele.name+" config error.");return false}}else{if(valu.length!=parseInt(lenDesc)){return setErrMessage(ele," the length must be "+lenDesc)}}}else{if(lim[0]=="between"&&lim[1].indexOf("-")>-1&&(vtype=="float"||vtype=="int")){var ls=lim[1].split("-");var fv=parseFloat(valu);if(ls[0]==""){if(fv>parseFloat(ls[1])){return setErrMessage(ele," can't more than "+ls[1])}}else{if(ls[1]==""){if(fv<parseFloat(ls[0])){return setErrMessage(ele," can't less than "+ls[0])}}else{if(fv<parseFloat(ls[0])||fv>parseFloat(ls[1])){return setErrMessage(ele," must between "+ls[0]+" and "+ls[1])}}}}else{if(lim[0]=="decLen"&&vtype=="float"){if((valu.length-valu.indexOf("."))>parseInt(lim[1])){var precision=Math.pow(10,parseInt(lim[1])||0);ele.value=Math.round(parseFloat(valu)*precision)/precision}}else{if(lim[0]=="equals"){var oevalue=eval("document."+formName+"."+lim[1]+".value");if(oevalue!=valu){return setErrMessage(ele," not match element "+lim[1]+"'s value.")}}}}}}}if(general&&vtype=="string"){if(containsSpecialChar(valu)){return setErrMessage(ele," can't allow contains special character.")}}}}global_formjs_valid_flag=true;return true}function clearMsgArea(b){var a=document.getElementById(b);if(a!=undefined&&a!=null){a.innerHTML=""}}function trim(a){return a.replace(/^\s+|\s+$/g,"")}function judgeDigit(){var b=arguments[0];if(arguments.length==1){return isDigit(b)}else{if(arguments.length==3){var a=/^-?[0-9]{1,10}$/;if(a.test(b)){var f=arguments[1];var e=parseInt(b);if(isDigit(arguments[2])){var c=parseInt(arguments[2]);if(f==">"||f=="<"){if(f==">"){return e>c}else{if(f=="<"){return e<c}}}else{if(isDigit(f)){var d=parseInt(f);return(e>=d)&&(e<=c)}else{alert("arguments error,the 2nd argument is not a number and not an operation:greater|less|equals.")}}}else{alert("arguments error,the 3rd argument is not a number.")}}}}return false}function isDigit(b){var a=/^[0-9]{1,10}$/;return a.test(b)}function isSignName(){var s=arguments[0];if(arguments.length==1){var patrn=/^[a-zA-Z]{1}([a-zA-Z0-9]|[._]){1,31}$/;return patrn.test(s)}else{if(arguments.length==3){if(isDigit(arguments[1])&&isDigit(arguments[2])){eval("var patrn=/^[a-zA-Z]{1}([a-zA-Z0-9]|[._]){"+(parseInt(arguments[1])-1)+","+(parseInt(arguments[2])-1)+"}$/;");return eval("patrn.test(s);")}else{alert("Error:the 2nd argument and the 3rd argument must be number.");return false}}else{alert("method invoke error.error arguments number.");return false}}}function isRealName(b){var a=/^([a-zA-Z0-9]|[._ ]){2,64}$/;var c=/^([^\x00-\xff]|[\s]){2,32}$/;return a.test(b)||c.test(b)}function isTel(b){var a=/^[+]{0,1}(\d){1,3}[ ]?([-]?((\d)|[ ]){1,12})+$/;return a.test(b)}function isMobileCN(b){var a=/^1[3|5]{1}[0-9]{1}[-| ]?\d{8}$/;return a.test(b)}function isPostalCodeCN(b){var a=/^[1-9]\d{5}$/;return a.test(b)}function isEmail(b){var a=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/;return a.test(b)}function isURL(b){var a=/^http:\/\/([\w-]+(\.[\w-]+)+(\/[\w-   .\/\?%&=\u4e00-\u9fa5]*)?)?$/;return a.test(b)}function isIP(b){var a=/^((1?\d?\d|(2([0-4]\d|5[0-5])))\.){3}(1?\d?\d|(2([0-4]\d|5[0-5])))$/;return a.test(b)}function isHtmlTag(b){var a=/^<(.*)>.*<\/\1>|<(.*) \/>$/;return a.test(b)}function isIDNumber15(b){var a=/^[\d]{6}((\d{2}((0[13578]|1[02])(0[1-9]|[12]\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\d|30)|02(0[1-9]|1\d|2[0-8])))|([02468][048]|[13579][26])0229)[\d]{3}$/;return a.test(b)}function isIDNumber18(b){var a=/^[\d]{6}[0-9]{4}(((0[13578]|(10|12))(0[1-9]|[1-2][0-9]|3[0-1]))|(02(0[1-9]|[1-2][0-9]))|((0[469]|11)(0[1-9]|[1-2][0-9]|30)))[\d]{3}[\d|x|X]$/;return a.test(b)}function isChineseString(b){var a=/^[\u4e00-\u9fa5]+$/;return a.test(b)}function isDoubleByteString(b){var a=/^[^x00-xff]+$/;return a.test(b)}function hasHESpace(b){var a=/^\s+|\s+$/;return a.test(b)}function isQQ(b){var a=/^[1-9]{1}\d{4,9}$/;return a.test(b)}function judgeFloat(){if(arguments.length==1){return isFloat(arguments[0])}else{if(arguments.length==2){eval("var patrn = /^-?\\d+.?\\d{0,"+arguments[1]+"}$/;");return eval("patrn.test(arguments[0]);")}else{if(arguments.length==4){var a3=arguments[2];if(a3==">"||a3=="<"){if(isFloat(arguments[3])){eval("var patrn = /^-?\\d+.?\\d{0,"+arguments[1]+"}$/;");if(eval("patrn.test(arguments[0]);")){if(a3=="<"){if(parseFloat(arguments[0])<parseFloat(arguments[3])){return true}}else{if(parseFloat(arguments[0])>parseFloat(arguments[3])){return true}}}return false}}else{if(isFloat(a3)){eval("var patrn = /^-?\\d+.?\\d{0,"+arguments[1]+"}$/;");if(eval("patrn.test(arguments[0]);")){var f0=parseFloat(arguments[0]);var f3=parseFloat(arguments[2]);var f4=parseFloat(arguments[3]);return f0>=f3&&f0<=f4}else{return false}}else{alert("the 3rd and the 4th arguments are not number.");return false}}}}}return false}function isFloat(b){var a=/^-?\d*.?\d+$/;return a.test(b)}function isLeapYear(a){return(a%4==0&&a%100!=0)||a%400==0}function isDateYMD(b){var a=/^(?:(?:(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(\/|-|\.)(?:0?2\1(?:29)))|(?:(?:(?:1[6-9]|[2-9]\d)?\d{2})(\/|-|\.)(?:(?:(?:0?[13578]|1[02])\2(?:31))|(?:(?:0?[1,3-9]|1[0-2])\2(29|30))|(?:(?:0?[1-9])|(?:1[0-2]))\2(?:0?[1-9]|1\d|2[0-8]))))$/;return a.test(b)}function isDateDMY(b){var a=/^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)0?2\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/;return a.test(b)}function isDateMDY(b){var a=/^(?:(?:(?:0?[13578]|1[02])(\/|-|\.)31)\1|(?:(?:0?[13-9]|1[0-2])(\/|-|\.)(?:29|30)\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:0?2(\/|-|\.)29\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:(?:0?[1-9])|(?:1[0-2]))(\/|-|\.)(?:0?[1-9]|1\d|2[0-8])\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/;return a.test(b)}function isDateTimeMDY(b){var a=/^(?=\d)(?:(?:(?:(?:(?:0?[13578]|1[02])(\/|-|\.)31)\1|(?:(?:0?[1,3-9]|1[0-2])(\/|-|\.)(?:29|30)\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})|(?:0?2(\/|-|\.)29\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))|(?:(?:0?[1-9])|(?:1[0-2]))(\/|-|\.)(?:0?[1-9]|1\d|2[0-8])\4(?:(?:1[6-9]|[2-9]\d)?\d{2}))($|\ (?=\d)))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\ [AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/;return a.test(b)}function isDateTimeYMD(b){var a=/^(?:(?:(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(\/|-|\.)(?:0?2\1(?:29)))|(?:(?:(?:1[6-9]|[2-9]\d)?\d{2})(\/|-|\.)(?:(?:(?:0?[13578]|1[02])\2(?:31))|(?:(?:0?[1,3-9]|1[0-2])\2(29|30))|(?:(?:0?[1-9])|(?:1[0-2]))\2(?:0?[1-9]|1\d|2[0-8]))))[ ]([0-1]?[0-9]|[2][0-3]):([0-5]?[0-9]):([0-5]?[0-9])$/;return a.test(b)}function isTime(b){var a=/^([0-1]?[0-9]|[2][0-3]):([0-5]?[0-9]):([0-5]?[0-9])$/;return a.test(b)}var validation_specialChars=new Array("'",'"',"\n","\r","\t",";",":","=","<",">",",","|","\\","<",">","/","^","~","`");function containsSpecialChar(b){for(var a=0;a<validation_specialChars.length;a++){if(b.indexOf(validation_specialChars[a])>-1){return true}}return false}function isDigitString(){return judgePattrnAndLen("-?\\d",arguments)}function isLetter(){return judgePattrnAndLen("[A-Za-z]",arguments)}function isUpperLetter(){return judgePattrnAndLen("[A-Z]",arguments)}function isLowerLetter(){return judgePattrnAndLen("[a-z]",arguments)}function isLetterNumString(){return judgePattrnAndLen("[A-Za-z0-9]",arguments)}function isLNUString(a){return judgePattrnAndLen("\\w",arguments)}function judgePattrnAndLen(){var pat=arguments[0];var as=arguments[1];if(as==null||as==undefined||as.length==0){alert("no arguments.");return false}else{if(as.length==1){eval("var patrn= /^"+pat+"+$/;");return eval("patrn.test(as[0]);")}else{if(as.length==3){if(isDigit(as[1])&&isDigit(as[2])){eval("patrn =/^"+pat+"{"+as[1]+","+as[2]+"}$/;");return eval("patrn.test(as[0]);")}else{alert("error arguments:the 2nd argument and the 3rd argument must be number.");return false}}else{alert("error arguments number");return false}}}}Array.prototype.in_array=function(a){for(i=0;i<this.length;i++){if(this[i]==a){return true}}return false};function isExtName(g,c){var f=g.value;var b=g.getAttribute("ext");var e=b.split(",");var a=f.lastIndexOf(".");var d=f.substring(a,f.length).toLowerCase();if(c){if(e.in_array(d)){return true}else{showDialog(d+"的文件格式不正确!","alert","文件格式错误","",0);return false}}};